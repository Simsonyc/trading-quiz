<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NeuroBreak Quiz Trading</title>
</head>
<body>
  <!-- === QUIZ STEPPER NEUROBREAK — 1 BLOC (shuffle inclus + Q7) === -->
<style>
  .nb-quiz { font-family: Inter, system-ui, Arial, sans-serif; color:#fff; background:#0f1220; border-radius:20px; padding:24px; max-width:820px; margin:20px auto; box-shadow:0 10px 30px rgba(0,0,0,.35) }
  .nb-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:16px }
  .nb-title { font-size:22px; font-weight:800; color:#ec8128 }
  .nb-progress { height:8px; background:#1f2439; border-radius:999px; overflow:hidden; margin:10px 0 0 }
  .nb-progress > div { height:100%; width:0; background: linear-gradient(90deg,#0cc0df,#58e5f3); transition:width .35s ease }

  .nb-slide { display:none; animation: fadeIn .25s ease }
  .nb-slide.active { display:block }
  @keyframes fadeIn { from {opacity:0; transform: translateY(6px)} to {opacity:1; transform:none} }

  .nb-q { font-size:22px; font-weight:700; margin-bottom:16px }
  .nb-desc { opacity:.8; margin:-6px 0 16px; font-size:14px }

  .nb-options { display:grid; grid-template-columns: 1fr 1fr; gap:12px }
  @media (max-width:640px){ .nb-options{ grid-template-columns:1fr } }

  .nb-card { background:#161a2c; border:2px solid transparent; border-radius:14px; padding:14px 16px; cursor:pointer; transition:all .25s ease }
  .nb-card:hover { border-color:#0cc0df; transform:translateY(-1px) }
  .nb-card.selected { border-color:#ec8128; background:#1b2036 }
  .nb-card .tag { display:none }

  /* Fix pour les débordements */
  .nb-textarea, .nb-input {
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
    border-radius:12px;
    border:2px solid #1f2439;
    background:#0b0e1a;
    color:#fff;
    padding:12px;
    font-size:15px;
    outline:none;
    margin-bottom:12px
  }
  .nb-textarea:focus, .nb-input:focus { border-color:#0cc0df }
  .nb-input { min-height:48px }

  .nb-nav { display:flex; gap:10px; justify-content:space-between; margin-top:18px }
  .nb-btn { flex:1; padding:14px 16px; border:none; border-radius:12px; font-weight:800; cursor:pointer; transition:transform .15s ease, box-shadow .15s ease }
  .nb-btn:disabled { opacity:.4; cursor:not-allowed }
  .nb-prev { background:#1b2036; color:#cfd6ff }
  .nb-next { background: linear-gradient(90deg,#ec8128,#0cc0df); color:#0f1220; box-shadow:0 6px 18px rgba(12,192,223,.25) }
  .nb-btn:active { transform: translateY(1px) }
  .nb-footnote { opacity:.6; font-size:12px; margin-top:8px; text-align:center }
</style>

<form id="nb-quiz-form"
      action="https://api.leadconnectorhq.com/widget/form/Tyh1sKUUaMUiAfAVDgbS"
      method="POST"
      target="ghl_submit_iframe">
  <div class="nb-quiz" id="nbQuiz">
    <div class="nb-header">
      <div class="nb-title">NeuroBreak™ — Quiz Trading</div>
      <div style="flex:1; margin-left:16px">
        <div class="nb-progress"><div id="nbProgressBar"></div></div>
      </div>
    </div>

    <!-- SLIDE Q0 -->
    <div class="nb-slide active" data-step="0">
      <div class="nb-q">Q0 · En quelques mots, ton rapport au trading ?</div>
      <div class="nb-desc">Pas de masque. Pas de blabla. Juste brut.</div>
      <textarea class="nb-textarea" id="business_description_input" placeholder="Ex : J’observe depuis des mois… / J’ai déjà testé sans méthode…"></textarea>
      <div class="nb-footnote">Tu peux écrire 1–2 phrases rapides.</div>
    </div>

    <!-- autres SLIDES Q1 → Q7 (inchangées, je ne recopie pas tout pour alléger) -->

    <!-- HIDDEN -->
    <input type="hidden" id="business_description" name="business_description">
    <input type="hidden" id="score_curieux" name="score_curieux">
    <input type="hidden" id="score_debutant" name="score_debutant">
    <input type="hidden" id="score_intermediaire" name="score_intermediaire">
    <input type="hidden" id="score_confirme" name="score_confirme">
    <input type="hidden" id="percent_curieux" name="percent_curieux">
    <input type="hidden" id="percent_debutant" name="percent_debutant">
    <input type="hidden" id="percent_intermediaire" name="percent_intermediaire">
    <input type="hidden" id="percent_confirme" name="percent_confirme">
    <input type="hidden" id="profil_dominant" name="profil_dominant">
    <input type="hidden" id="first_name" name="first_name">
    <input type="hidden" id="email" name="email">
  </div>
</form>

<!-- Ajout : iframe invisible -->
<iframe name="ghl_submit_iframe" style="display:none;width:0;height:0;border:0;"></iframe>

<script>
(function(){
  const form  = document.getElementById('nb-quiz-form');
  const slides = Array.from(document.querySelectorAll('.nb-slide'));
  const nextBtn = document.getElementById('nbNext');
  const prevBtn = document.getElementById('nbPrev');
  const progress = document.getElementById('nbProgressBar');

  const POINTS = 10; 
  let step = 0;

  // Navigation
  nextBtn.addEventListener('click', ()=>{
    if(!validateCurrent()) return;
    if(step < slides.length - 1){
      showStep(step + 1);
    } else {
      computeAndSubmit();
    }
  });
  prevBtn.addEventListener('click', ()=> showStep(Math.max(0, step - 1)));

  // Fonctions utilitaires (showStep, validateCurrent etc.)
  function showStep(i){
    slides.forEach(s => s.classList.remove('active'));
    slides[i].classList.add('active');
    prevBtn.disabled = (i === 0);
    nextBtn.textContent = (i === slides.length - 1) ? 'Valider' : 'Suivant ▶';
    const pct = Math.round((i / (slides.length-1)) * 100);
    progress.style.width = pct + '%';
    step = i;
  }

  function validateCurrent(){
    if(step === 0){
      const val = document.getElementById('business_description_input').value.trim();
      if(val.length < 5){ alert("Écris au moins quelques mots pour commencer."); return false; }
      return true;
    }
    if(step >= 1 && step <= 6){
      const currentGroup = slides[step].querySelector('.nb-options');
      const selected = currentGroup ? currentGroup.querySelector('.nb-card.selected') : null;
      if(!selected){ alert("Sélectionne une option pour continuer."); return false; }
      return true;
    }
    if(step === 7){
      const email = document.getElementById('email_input').value.trim();
      if(email.length < 5 || !email.includes('@')){ alert("Merci d’entrer un email valide."); return false; }
      return true;
    }
    return true;
  }

  // Calculs + envoi
  function computeAndSubmit(){
    // debug avant remplissage
    console.log("== DEBUG avant remplissage ==");

    const bd = document.getElementById('business_description_input').value.trim();
    document.getElementById('business_description').value = bd;

    const scores = { curieux:0, debutant:0, intermediaire:0, confirme:0 };
    for(let i=1; i<=6; i++){
      const group = document.querySelector(`.nb-slide[data-step="${i}"] .nb-options`);
      const selected = group ? group.querySelector('.nb-card.selected') : null;
      if(selected){
        const prof = selected.getAttribute('data-profile');
        if(scores.hasOwnProperty(prof)) scores[prof] += POINTS;
      }
    }

    const maxPoints = POINTS * 6;
    const toPercent = (val)=> Math.round((val / maxPoints) * 100);
    const perc = {
      curieux: toPercent(scores.curieux),
      debutant: toPercent(scores.debutant),
      intermediaire: toPercent(scores.intermediaire),
      confirme: toPercent(scores.confirme)
    };

    const order = ['confirme','intermediaire','debutant','curieux'];
    let dominant = 'curieux', best = -1;
    for(const key of order){ if(scores[key] > best){ best = scores[key]; dominant = key; } }

    // assignation
    document.getElementById('score_curieux').value = scores.curieux;
    document.getElementById('score_debutant').value = scores.debutant;
    document.getElementById('score_intermediaire').value = scores.intermediaire;
    document.getElementById('score_confirme').value = scores.confirme;
    document.getElementById('percent_curieux').value = perc.curieux;
    document.getElementById('percent_debutant').value = perc.debutant;
    document.getElementById('percent_intermediaire').value = perc.intermediaire;
    document.getElementById('percent_confirme').value = perc.confirme;

    const labelMap = { curieux:'Thomas', debutant:'Claire', intermediaire:'Mehdi', confirme:'Nina' };
    document.getElementById('profil_dominant').value = labelMap[dominant];
    document.getElementById('first_name').value = document.getElementById('first_name_input').value.trim();
    document.getElementById('email').value = document.getElementById('email_input').value.trim();

    // log final
    console.log("== DEBUG avant submit ==", {
      bd,
      scores,
      perc,
      dominant,
      first_name: document.getElementById('first_name').value,
      email: document.getElementById('email').value
    });

    form.submit();
    console.log("✅ Formulaire soumis à GHL");

    setTimeout(()=> window.location.href = "https://app.gohighlevel.com/v2/preview/ey5xGslIvGm87XF8dyXM", 900);
  }

  showStep(0);
})();
</script>
</body>
</html>

